document.addEventListener('DOMContentLoaded', () => {
  // Intro / стартове вікно
  const intro = document.getElementById('intro');
  const startBtn = document.getElementById('startBtn');
  const site = document.getElementById('siteContent');

  function openSite() {
    if (!intro || !site) return;
    // ховаємо intro (доступність + клас для анімації)
    intro.setAttribute('aria-hidden', 'true');
    intro.classList.add('hidden');
    // після анімації прибираємо з потоку сторінки
    setTimeout(() => { intro.style.display = 'none'; }, 300);
    // показуємо основний вміст
    site.setAttribute('aria-hidden', 'false');
    // фокус на перший фокусований елемент сайту
    const first = site.querySelector('a, button, [tabindex]') || site;
    if (first && typeof first.focus === 'function') first.focus();
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }

  startBtn?.addEventListener('click', openSite);
  startBtn?.addEventListener('keydown', (e) => { if (e.key === 'Enter' || e.key === ' ') openSite(); });

  // Якщо потрібно одразу відкривати сайт (наприклад тест), можна використовувати хеш
  if (location.hash === '#open') openSite();

  // Nav toggle for mobile
  const nav = document.getElementById('mainNav');
  const btn = document.getElementById('navToggle');
  btn?.addEventListener('click', () => nav.classList.toggle('show'));

  // Gallery modal
  const modal = document.getElementById('imgModal');
  const modalImg = document.getElementById('modalImg');
  const modalCaption = document.getElementById('modalCaption');
  const modalClose = document.getElementById('modalClose');

  document.getElementById('galleryGrid')?.addEventListener('click', (e) => {
    const img = e.target.closest('img');
    if (!img) return;
    const full = img.dataset.full || img.src;
    modalImg.src = full;
    modalImg.alt = img.alt || '';
    modalCaption.textContent = img.alt || '';
    modal.setAttribute('aria-hidden', 'false');
    document.body.style.overflow = 'hidden';
  });

  function closeModal() {
    modal.setAttribute('aria-hidden', 'true');
    modalImg.src = '';
    document.body.style.overflow = '';
  }

  modalClose?.addEventListener('click', closeModal);
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal && modal.getAttribute('aria-hidden') === 'false') closeModal();
  });

  const articles = [
    {
      id: 1,
      title: "Як мозок створює спогади",
      preview: "Мозок — це “жива бібліотека”, де зберігається наша історія. Дізнайся, як утворюються спогади та чому вони змінюються з часом.",
      body: `Мозок — це своєрідна “жива бібліотека”, у якій зберігається вся наша історія: від дитячих моментів до того, що ми вивчили вчора. Але як саме утворюються спогади?<br><br>Усе починається з нейронів — клітин, які передають інформацію за допомогою електричних сигналів. Коли ми щось бачимо, чуємо або відчуваємо, певна група нейронів активується й утворює нові зв’язки, що називаються синапсами. Саме ці зв’язки формують слід у мозку — основу спогаду.<br><br>Існує кілька типів пам’яті:<br><ul><li>Короткочасна пам’ять — зберігає інформацію на кілька секунд або хвилин (наприклад, коли запам’ятовуєш номер телефону).</li><li>Довготривала пам’ять — дозволяє зберігати інформацію роками. Вона зміцнюється повторенням і практикою.</li><li>Емоційна пам’ять — найстійкіша. Якщо подія була пов’язана з сильними емоціями, мозок “позначає” її як важливу.</li></ul>Цікаво, що наші спогади не є точними копіями минулого. Кожного разу, коли ми згадуємо щось, мозок переписує цей спогад, додаючи нові деталі або прибираючи старі. Тому іноді ми впевнені в тому, чого насправді не було.<br><br>Велику роль у формуванні пам’яті відіграє гіпокамп — структура в глибині мозку, схожа на морського коника. Якщо гіпокамп пошкодити, людина може забути навіть події, що сталися нещодавно.<br>Тож, коли ти вчиш щось нове, давай мозку час “закріпити” інформацію: повтори матеріал, поспи, і твій мозок зробить решту.<br><br>Пам’ять — це не просто зберігання даних, як у комп’ютері. Це процес, у якому бере участь уся твоя свідомість — від емоцій до творчого мислення.`
    },
    {
      id: 2,
      title: "Що відбувається в мозку, коли ми мріємо",
      preview: "Чому ми бачимо сни? Як мозок працює під час сну і чому це важливо для емоцій та пам’яті?",
      body: `Ми проводимо у снах третину життя, але до кінця не розуміємо, навіщо вони нам потрібні. Чому ми бачимо дивні історії ночами? І що робить наш мозок, поки тіло відпочиває?<br><br>Під час сну мозок не вимикається — він продовжує працювати, просто в іншому режимі.<br>Є кілька фаз сну, але найцікавіша — REM-фаза (від англ. Rapid Eye Movement). Саме тоді ми бачимо сни. У цей час очі швидко рухаються під повіками, тіло розслаблене, а мозок активний майже так само, як удень.<br><br>Під час сновидінь активуються ділянки мозку, що відповідають за емоції, пам’ять і творчість — амігдала, гіпокамп і тім’яні долі. Натомість частина, що контролює логіку (лобова кора), працює слабше. Тому сни виглядають нелогічними: ми можемо літати, розмовляти з тваринами або опинятися в кількох місцях одночасно.<br><br>Але це не безглуздо. Учені довели, що сни — спосіб мозку опрацьовувати інформацію. Він “переглядає” події дня, видаляє непотрібне, зміцнює важливі спогади та шукає нові рішення. Часто після сну ми прокидаємось із натхненням або розв’язанням проблеми, над якою думали раніше — і це не випадково.<br><br>Цікаво, що сни можуть впливати на емоційний стан. Коли ми бачимо щось страшне чи тривожне, мозок “тренується” реагувати на страх у безпечних умовах.<br>Тому сни — це своєрідна психотерапія, яку наш мозок проводить щовночі.<br><br>Наступного разу, коли тобі присниться щось дивне, не поспішай забувати. Можливо, твій мозок саме вирішував проблему, яку ти навіть не помітив удень.`
    },
    {
      id: 3,
      title: "Електричний мозок",
      preview: "Думки, дії, спогади — це електричні імпульси між мільярдами нейронів. Як мозок створює і використовує електроенергію?",
      body: `Мозок — це найскладніша електрична система у світі. Кожна думка, кожна дія, навіть кожен спогад — це результат електричних імпульсів, що проходять між мільярдами нейронів.<br><br>У середньому мозок містить близько 86 мільярдів нейронів, і кожен з них може мати до 10 тисяч зв’язків із сусідніми клітинами. Це означає, що у твоїй голові відбувається трильйони електричних процесів щосекунди!<br><br>Нейрони спілкуються за допомогою електрохімічних сигналів. Коли клітина отримує імпульс, вона передає його далі через синапси — крихітні “місточки” між клітинами.<br>Цей сигнал може рухатись зі швидкістю до 300 км/год, а отже, мозок реагує майже миттєво.<br><br>Проте мозок не просто проводить струм — він його створює. І робить це без жодних батарей! Енергію для цього забезпечує хімічна реакція між іонами натрію, калію та кальцію всередині клітин.<br><br>Саме завдяки електричній активності ми можемо:<br><ul><li>думати, відчувати й мріяти;</li><li>рухатись і координувати тіло;</li><li>бачити, чути, торкатись.</li></ul>Мозкові імпульси можна навіть виміряти — це робить електроенцефалографія (ЕЕГ). Вона показує хвилі різної частоти, залежно від стану людини:<br><ul><li>Альфа-хвилі — коли ми розслаблені;</li><li>Бета-хвилі — коли думаємо або активно працюємо;</li><li>Дельта-хвилі — під час глибокого сну.</li></ul>Це доводить, що мозок — це живий генератор енергії, який ніколи не вимикається. Навіть коли ми спимо, він створює електричні візерунки — своєрідну “музику” нашої свідомості.`
    },
    {
      id: 4,
      title: "Як емоції впливають на тіло",
      preview: "Емоції починаються в мозку, але проявляються у всьому тілі. Дізнайся, як вони впливають на здоров’я та поведінку.",
      body: `Коли ти хвилюєшся перед виступом, відчуваєш “метеликів у животі”? Це не вигадка — це результат реальної роботи мозку.<br><br>Емоції починаються в мозку, але проявляються у всьому тілі. Коли ти відчуваєш страх, радість чи здивування, мозок активує лімбічну систему — зокрема амігдалу, яка “запускає” тілесні реакції.<br>Вона надсилає сигнали до серця, м’язів, шкіри та навіть шлунка. Тому ми червоніємо від сорому, стискаємо кулаки від злості або відчуваємо тепло від радості.<br><br>Ці реакції мають еволюційне походження. Колись вони допомагали вижити: страх готував тіло до втечі, гнів — до боротьби, радість — до соціальної взаємодії.<br>Сьогодні ці механізми залишились, хоча небезпека часто лише у голові.<br><br>Емоції впливають навіть на імунну систему. Хронічний стрес може послабити організм, тоді як позитивні переживання — навпаки, підвищують стійкість до хвороб.<br><br>Мозок і тіло пов’язані настільки тісно, що навіть посмішка може змінити твої емоції. Коли ти посміхаєшся, навіть штучно, активуються ті самі нейронні кола, що й при справжній радості. Тому мозок “вірить”, що ти щасливий — і починає виділяти гормони щастя: серотонін, ендорфіни та дофамін.<br><br>Пам’ятай: емоції — це не слабкість, а мовa мозку. Через них він спілкується з тілом, допомагаючи нам відчувати, переживати та розуміти світ.`
    }
  ];

  const articleModal = document.getElementById('articleModal');
  const articleTitle = document.getElementById('articleTitle');
  const articleBody = document.getElementById('articleBody');
  const articleClose = document.getElementById('articleClose');

  // Відкриття статті
  function openArticle(id) {
    const article = articles.find(a => a.id === id);
    if (article) {
      articleTitle.textContent = article.title;
      articleBody.innerHTML = article.body;
      articleModal.setAttribute('aria-hidden', 'false');
      articleModal.style.display = 'block';
    }
  }

  // Закриття модала
  articleClose.addEventListener('click', () => {
    articleModal.setAttribute('aria-hidden', 'true');
    articleModal.style.display = 'none';
  });

  // Відкриття по кліку
  const articleCards = document.querySelectorAll('.article-card');
  articleCards.forEach(card => {
    card.addEventListener('click', () => {
      openArticle(Number(card.dataset.id));
    });
  });

  const readMoreBtns = document.querySelectorAll('.read-more');
  readMoreBtns.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.stopPropagation();
      openArticle(Number(btn.dataset.id));
    });
  });

  // Анімація падіння пелюсток у hero-block
  function createPetal() {
    const petal = document.createElement('img');
    petal.src = '3d6d506abfeccc8a7308c6f4f20bd801.jpg'; // замініть на реальний шлях
    petal.className = 'petal';
    petal.style.left = Math.random() * 90 + '%';
    petal.style.animationDuration = (6 + Math.random() * 3) + 's';
    document.querySelector('.petals-bg')?.appendChild(petal);
    setTimeout(() => petal.remove(), 9000);
  }
  setInterval(createPetal, 1200);
  for (let i = 0; i < 8; i++) createPetal();
});